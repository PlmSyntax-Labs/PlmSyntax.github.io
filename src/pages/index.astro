---
import MarketingLayout from '@/layouts/MarketingLayout.astro';
import Hero from '@sections/marketing/Hero.astro';
import HowItWorks from '@sections/marketing/HowItWorks.astro';
import FeaturesSection from '@sections/marketing/FeaturesSection.astro';
import PricingTable from '@sections/pricing/PricingTable.astro';
import CTA from '@sections/marketing/CTA.astro';
import { siteConfig, modules } from '@/config';

const features = [
  {
    icon: 'lucide:merge',
    title: 'Smart Merge',
    description:
      'Automatically resolve UID/IDREF collisions across hundreds of files while maintaining reference integrity.',
  },
  {
    icon: 'lucide:shield',
    title: 'IP Guard',
    description:
      'Sanitize and mask sensitive metadata before sharing PLMXML with external vendors or support.',
  },
  {
    icon: 'lucide:file-search',
    title: 'Structure Audit',
    description:
      'Detect broken links and missing elements instantly. Export hierarchy data to Excel for easy reporting.',
  },
];

const pricingPlans = [
  {
    name: 'Single Module',
    monthlyPrice: null,
    customPrice: '$349',
    description: 'Single User License — Pick any module',
    features: [
      'Merge or IP Guard or Audit',
      'Full functionality for one tool',
      'Lifetime license',
      'Standard support',
    ],
    cta: { label: 'Get 50% Early Bird Discount', href: '#waitlist' },
  },
  {
    name: 'Enterprise Suite',
    monthlyPrice: null,
    customPrice: '$849',
    description: 'Single User License — All 3 modules',
    features: [
      'Smart Merge engine suite',
      'IP Guard sanitization',
      'Structure Audit + Excel export',
      'Priority support',
    ],
    highlighted: true,
    badge: 'Most Popular',
    cta: { label: 'Get 50% Early Bird Discount', href: '#waitlist' },
  },
  {
    name: 'Team',
    monthlyPrice: null,
    customPrice: 'Custom',
    description: 'Team License (from 5 seats) — All modules',
    features: [
      'Multiple Seats for the whole team',
      'Everything in Enterprise Suite',
      'Volume discount built in',
      'Priority support',
    ],
    cta: { label: 'Get 50% Early Bird Discount', href: '#waitlist' },
  },
];
---

<MarketingLayout
  title={`${siteConfig.name} - ${siteConfig.description}`}
  description={siteConfig.description}
>
  <Hero
    title="Stop Merging PLMXML Files Manually."
    subtitle="The intelligent desktop toolkit for PLM Engineers. Resolve UID collisions, sanitize sensitive IP, and audit your data integrity in seconds. No cloud, 100% offline."
    primaryCTA={{ label: 'Get 50% Early Bird Discount', href: '#waitlist' }}
    secondaryCTA={{ label: 'See How It Works', href: '#how-it-works' }}
  />

  <HowItWorks
    title="How PlmSyntax Works"
    subtitle="From broken references to clean, validated data in three steps."
    steps={[
      {
        title: 'Load your PLMXML files',
        description:
          'Drop your split or exported PLMXML files into PlmSyntax. Handles massive XML structures using high-performance iterative parsing. No memory crashes on large assemblies.',
        icon: 'lucide:folder-input',
      },
      {
        title: 'Merge, Guard, or Audit',
        description:
          'Select your operation. PlmSyntax resolves UID collisions, sanitizes sensitive IP, or audits structure integrity automatically.',
        icon: 'lucide:settings',
      },
      {
        title: 'Export clean results',
        description:
          'Get validated, collision-free PLMXML output or structured Excel reports. Ready for production use.',
        icon: 'lucide:file-check',
      },
    ]}
    variant="horizontal"
    background="muted"
  />

  <FeaturesSection
    title="The PlmSyntax Suite"
    subtitle="Three precision tools for PLMXML data integrity. Each solves a specific pain point in PLM data management."
    features={features}
    background="default"
  />

  <!-- Use Cases Section (replaces testimonials) -->
  <section class="py-section bg-surface">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center max-w-3xl mx-auto mb-12">
        <h2 class="text-3xl sm:text-4xl font-bold text-text">Built for High-Stakes PLM Workflows</h2>
        <p class="mt-4 text-lg text-text-muted">Solving the most critical challenges in data migration and vendor collaboration.</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="p-8 rounded-lg bg-background border border-border">
          <div class="w-12 h-12 flex items-center justify-center rounded-md bg-primary/10 text-primary mb-5">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
          </div>
          <h3 class="text-xl font-semibold text-text mb-3">Large-Scale Data Migration</h3>
          <p class="text-text-muted leading-relaxed">Stop wasting days on manual merging. PlmSyntax automates the resolution of UID collisions that otherwise cause critical import failures in production environments.</p>
        </div>
        <div class="p-8 rounded-lg bg-background border border-border">
          <div class="w-12 h-12 flex items-center justify-center rounded-md bg-primary/10 text-primary mb-5">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
          </div>
          <h3 class="text-xl font-semibold text-text mb-3">Multi-Site Data Exchange</h3>
          <p class="text-text-muted leading-relaxed">Validate IDREF integrity across hundreds of split PLMXML files instantly. Ensure your supplier data is production-ready before it touches your server.</p>
        </div>
        <div class="p-8 rounded-lg bg-background border border-border">
          <div class="w-12 h-12 flex items-center justify-center rounded-md bg-primary/10 text-primary mb-5">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
          </div>
          <h3 class="text-xl font-semibold text-text mb-3">Secure Vendor Collaboration</h3>
          <p class="text-text-muted leading-relaxed">Use IP Guard to strip proprietary metadata and internal part intelligence. Share the structure you need without exposing the intellectual property you must protect.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Why Desktop Section -->
  <section class="py-section bg-background" id="why-desktop">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center max-w-3xl mx-auto">
        <h2 class="text-3xl sm:text-4xl font-bold text-text">Why a Desktop Tool?</h2>
        <p class="mt-4 text-lg text-text-muted">
          Your PLMXML data contains proprietary product structures, part numbers, and manufacturing intelligence. It should never leave your infrastructure.
        </p>
      </div>
      <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="p-6 rounded-lg bg-surface border border-border text-center">
          <div class="w-12 h-12 flex items-center justify-center rounded-md bg-primary/10 text-primary mb-4 mx-auto">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
          </div>
          <h3 class="text-lg font-semibold text-text mb-2">100% Offline</h3>
          <p class="text-text-muted">No cloud uploads. No API calls. Your data never leaves your machine.</p>
        </div>
        <div class="p-6 rounded-lg bg-surface border border-border text-center">
          <div class="w-12 h-12 flex items-center justify-center rounded-md bg-primary/10 text-primary mb-4 mx-auto">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/></svg>
          </div>
          <h3 class="text-lg font-semibold text-text mb-2">Data Sovereignty</h3>
          <p class="text-text-muted">Meets the strictest enterprise security and compliance requirements out of the box.</p>
        </div>
        <div class="p-6 rounded-lg bg-surface border border-border text-center">
          <div class="w-12 h-12 flex items-center justify-center rounded-md bg-primary/10 text-primary mb-4 mx-auto">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
          </div>
          <h3 class="text-lg font-semibold text-text mb-2">No Dependencies</h3>
          <p class="text-text-muted">Standalone Windows utility. No server, no subscription, no internet connection required.</p>
        </div>
      </div>
      <div class="mt-10 text-center">
        <p class="text-text-muted italic border-l-4 border-primary pl-4 max-w-2xl mx-auto text-left">
          "Data sovereignty is our priority. PlmSyntax is a standalone Windows utility. Your PLMXML data never leaves your infrastructure."
        </p>
      </div>
    </div>
  </section>

  <PricingTable
    title="Permanent Licenses. No Subscriptions."
    subtitle="Buy once, own forever. Choose the module you need or get the full suite."
    plans={pricingPlans}
    background="default"
  />

  <CTA
    title="Ready to stop the manual pain?"
    description="PlmSyntax is currently in final QA. We are accepting a limited number of early adopters for our Q3 2026 launch. Secure your 50% launch discount."
    action={{ label: 'Get 50% Early Bird Discount', href: '#waitlist' }}
  />

  <!-- Waitlist Modal -->
  <div id="waitlist-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 backdrop-blur-sm">
    <div class="relative bg-background border border-border rounded-lg shadow-2xl max-w-md w-full mx-4 p-8">
      <button id="waitlist-close" type="button" class="absolute top-4 right-4 text-text-muted hover:text-text transition-colors cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
      <h3 class="text-2xl font-bold text-text">Secure Your Early Bird Spot</h3>
      <p class="mt-3 text-text-muted text-sm leading-relaxed">
        PlmSyntax is currently in final QA. We are accepting a limited number of early adopters for our Q3 2026 launch. Enter your email to secure a <strong class="text-primary">50% launch discount</strong> and get notified the moment we go live.
      </p>
      <form id="waitlist-form" class="mt-6 space-y-4">
        <div>
          <label for="waitlist-email" class="block text-sm font-medium text-text mb-1">Work Email</label>
          <input
            type="email"
            id="waitlist-email"
            name="email"
            required
            placeholder="you@company.com"
            class="w-full px-4 py-2.5 rounded-md border border-border bg-surface text-text placeholder:text-text-muted/60 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"
          />
        </div>
        <div>
          <label for="waitlist-module" class="block text-sm font-medium text-text mb-1">Interested in</label>
          <select
            id="waitlist-module"
            name="module"
            class="w-full px-4 py-2.5 rounded-md border border-border bg-surface text-text focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"
          >
            {modules.map((module) => (
              <option value={module.id}>{module.label}</option>
            ))}
          </select>
        </div>
        <div>
          <label for="waitlist-company" class="block text-sm font-medium text-text mb-1">Company (optional)</label>
          <input
            type="text"
            id="waitlist-company"
            name="company"
            placeholder="Acme Engineering"
            class="w-full px-4 py-2.5 rounded-md border border-border bg-surface text-text placeholder:text-text-muted/60 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary"
          />
        </div>
        <button
          type="submit"
          class="w-full px-6 py-3 rounded-md bg-primary text-white font-medium hover:bg-primary-dark transition-colors cursor-pointer"
        >
          Reserve My 50% Discount
        </button>
        <p class="text-xs text-text-muted text-center">No spam. Unsubscribe anytime. We respect your privacy.</p>
      </form>
      <!-- Success state -->
      <div id="waitlist-success" class="hidden text-center py-4">
        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-primary/10 flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        </div>
        <h4 class="text-xl font-bold text-text">You're on the list!</h4>
        <p class="mt-2 text-text-muted text-sm">We'll notify you the moment PlmSyntax launches with your exclusive early bird discount.</p>
      </div>
    </div>
  </div>

  <script>
    function initWaitlistModal() {
      const modal = document.getElementById('waitlist-modal');
      const closeBtn = document.getElementById('waitlist-close');
      const form = document.getElementById('waitlist-form');
      const successMsg = document.getElementById('waitlist-success');

      // Open modal on any #waitlist link click
      document.querySelectorAll('a[href="#waitlist"]').forEach((link) => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          modal?.classList.remove('hidden');
          modal?.classList.add('flex');
        });
      });

      // Close modal
      function closeModal() {
        modal?.classList.add('hidden');
        modal?.classList.remove('flex');
      }

      closeBtn?.addEventListener('click', closeModal);
      modal?.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeModal();
      });

      // Form submit - send to Google Forms, then show success
      form?.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = (document.getElementById('waitlist-email') as HTMLInputElement)?.value;
        const company = (document.getElementById('waitlist-company') as HTMLInputElement)?.value;
        const module = (document.getElementById('waitlist-module') as HTMLSelectElement)?.value;

        const googleFormUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSceruEk5bdlwXLXVf6wKnUeByspX69VZTV-hWgcY_RpMSgKxg/formResponse';
        const params = new URLSearchParams();
        params.append('entry.361515637', email);
        
        // Combine company and module with a divider
        const companyWithModule = company ? `${company} | Module: ${module}` : `Module: ${module}`;
        params.append('entry.1585641090', companyWithModule);

        // Submit silently (Google Forms doesn't support CORS, so we use no-cors)
        fetch(googleFormUrl, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: params.toString(),
        }).finally(() => {
          form.classList.add('hidden');
          successMsg?.classList.remove('hidden');
        });
      });
    }

    initWaitlistModal();
    document.addEventListener('astro:page-load', initWaitlistModal);
  </script>
</MarketingLayout>
